<!DOCTYPE HTML>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name=description content="最新日本陀螺情報、所有部件（攻擊環 結晶盤 輪盤 軸心 底盤）圖鑑、限量產品，都一應俱全。">
<script src=/burst/include/common.js></script>
<title>非官方資訊站 ￭ Beyblade Burst unofficial site</title>
<link rel=stylesheet href=index.css>
<style>
    html:not(.day) {background:black;}
    html::before {
        content:'請重新整理 Please refresh';
        opacity:0;animation:appear .5s 2s forwards;
        text-align:center;color:white;font-size:3em;
        position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    }
    @keyframes appear { to {opacity:1;} }
    body {opacity:0;}

    #now article img {width:49%;max-width:12em;}
    #now img[src*=instagram],#now img[src*=twimg],#now img[src*=scontent] {width:100%;max-width:20em;}
    body {background:url(https://pbs.twimg.com/media/FyHma6_akAEPYb2?format=jpg&name=large) no-repeat center center / cover;}
    header {background:url(https://beyblade.takaratomy.co.jp/burst/public_html/category/img/logo_s.png) 0.5em 65% / auto 70% no-repeat;}
    section fieldset~:not(dialog-gallery) {
        color:hsl(var(--glow),100%,70%);
        text-shadow: 0 0 1em hsl(var(--glow),100%,70%), 0 0 2em hsl(var(--glow),100%,50%)
    }
</style>

<header>
    <h1>戰鬥陀螺 爆烈世代￨爆旋陀螺 擊爆戰魂</h1>
    <h2>非官方資訊站</h2>
    <h1>Beyblade Burst</h1>
    <h2>Unofficial information Site</h2>
</header>

<section id=contents>
    <svg style='display:none'>
        <defs>
            <polygon id=hexa stroke-width=0.3 points='10,0 5,-8.66 -5,-8.66 -10,0 -5,8.66 5,8.66'/>
            <g id=gear stroke-width=2>
                <circle cx=0 cy=0 r=10 fill=hsla(0,0%,0%,0.2) />
                <circle cx=0 cy=0 r=50 fill=none />
            </g>
        </defs>
    </svg>
    <menu>
        <svg viewBox='-10 -10 20 20'><use href=#hexa /></svg>
        <svg viewBox='-10 -10 20 20'><use href=#hexa /></svg>
        <li><a><span>教學<br>Guide</span></a></li>
        <li><a><span>研究<br>Studies</span></a></li>
        <li><a><span>圖片<br>Images</span></a></li>
        <li><a href=parts/ ><span>部件<br>Parts</span></a></li>
        <li><a href=products/ ><span>商品<br>Products</span></a></li>
        <li><a href=prize/ ><span>景品<br>Prizes</span></a></li>
        <db-status></db-status>
    </menu>
    <div>
        <span>官方連結</span>
        <a data-icon= href=https://beyblade.takaratomy.co.jp/burst/ >Takara Tomy</a>
        <a data-icon= href=https://m.facebook.com/Beyblade2016/posts/ >戰鬥陀螺 TW</a>
        <a data-icon= href=https://m.facebook.com/tclubfanshk/posts/ >T CLUB</a>
    </div>
</section>

<script>
    const gears = g => {
        let polar = (m, angle) => [m * Math.cos(angle), m * Math.sin(angle)];
        let l = 3.5 * g, s = 3.4 * g - 8, t = Math.PI / (50 + 2.5 * g);
        let gear = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        gear.setAttribute('d', [...Array(g)].reduce((points, _, i) => {
            let [lx, ly] = polar(l, Math.PI / g * (2 * i - 1) + t);
            let [lxn, lyn] = polar(l, Math.PI / g * 2 * i - t);
            let [sx, sy] = polar(s, Math.PI / g * (2 * i) + t / 2);
            let [sxn, syn] = polar(s, Math.PI / g * (2 * i + 1) - t / 2);
            return points += `${i > 0 ? 'L' : ''} ${lx},${ly} A ${l},${l},0,0,1,${lxn},${lyn} L ${sx},${sy} A ${s},${s},0,0,1,${sxn},${syn}`;
        }, 'M ') + 'Z');
        return gear;
    }
    (() => {
        Q("#gear").append(gears(20));
        Q('menu a', a => a.insertAdjacentHTML('afterbegin', "<svg viewBox='-65 -65 130 130'><use href=#gear /></svg>"));

        [315, 15, 255, 135, 195, 75].forEach((color, i) => {
            let link = Q(`menu li:nth-of-type(${i + 1})`);
            [link.style.left, link.style.top] = [(50 * Math.cos(Math.PI / 3 * i) + 50) + '%', (50 * Math.sin(Math.PI / 3 * i) + 50) + '%'];
            link.style.setProperty('--c', color);
        });
        Q('menu').style.setProperty('--r', Math.random() * 360);
    })();
</script>

<section id=now>
    <template>
        <article>
            <time></time>
            <h5></h5>
            <h4></h4>
            <div>
                <a data-icon= href='https://www.youtube.com/results?q='></a>
            </div>
            <iframe src=https://www.youtube.com/embed/ allowfullscreen=""></iframe>
        </article>
    </template>
    <fieldset>
        <h3><span>最</span><span>新</span><span>商</span><span>品</span></h3>
    </fieldset>
    <img src=https://beyblade.takaratomy.co.jp/burst/public_html/category/img/logo_s.png style='width:20em'>
    <p style='font-family:Mincho;font-size:1.5em;margin-top:-.4em'>2015.07～2022.12</p>
    <p style='font-size:2em;line-height:1.2;margin:.25em auto 1em auto;'>所有主線商品<br>經已悉數推出</p>
    <a href="#catalog" style="margin-bottom:1em;display:block;">香港產品目錄</a>
</section>

<section id=reboot>
    <h5> 更多已推出產品圖片・數據（日文網站）</h5>
    <ul>
        <li><a rel=noreferrer href='http://kyoganken.web.fc2.com/beyba/index.htm' target=_blank>競技玩具研究所</a>
        <li><a rel=noreferrer href='https://hamusuke.com/?s=レビュー' target=_blank>ハムすけの備忘録</a>
        <li><a rel=noreferrer href='http://obakeblader.com/2021/08/16/post-17693/' target=_blank>おばけブレーダーブログ</a>
    </ul>
    <h5>V6 Ultimate</h5>
    <dl style="display:none">
        <div title=V0><dt>2016 秋</dt><dd>把以圖片製成的《部件圖鑑》及《景品圖鑑》放上互聯網</dd></div>
        <div title=V1><dt>2017 春</dt><dd>正式成立網站，新增主頁、商品頁面等內容</dd></div>
        <div title=V2><dt>2018 冬</dt><dd>《部件圖鑑》改為網頁版，以提供更多內容及功能</dd></div>
        <div title=V3><dt>2019 夏</dt><dd>大部份功能改以 Javascript 製作，使頁面載入加快</dd></div>
        <div title=V4><dt>2020 夏</dt><dd>使用瀏覽器的 IndexedDB，把不需再更新的資料儲藏</dd></div>
        <div title=V5><dt>2021 春</dt><dd>改成靜態的 Progressive web app，可離線使用</dd></div>
        <div title=V6><dt>2022 春</dt><dd>強化及改善各項篩選工具、頁面重新整合</dd></div>
    </dl>
    <div>
        <p><i id=flush data-icon=></i><span>更新檔案（～250 KB）</span><i></i></p>
         如在本網遇上問題 
        <p><i id=reset data-icon=></i><span>重設儲存（～30 MB）</span><i></i></p>
    </div>
</section>

<script>
    const announce = news => news.forEach(bey => {
        if (typeof bey == 'string')
            return Q('#now fieldset').insertAdjacentHTML('beforeend', bey);

        let t = Q('template').content.cloneNode(true);
        let [date, code, name, desc, {video, keyword}] = bey;
        Object.entries({time: date, h5: code, h4: name, div: desc}).forEach(([el, content]) => 
            t.Q(el).insertAdjacentHTML('afterBegin', content)
        );
        keyword ? t.Q('div a[href*=youtube]').href += keyword : t.Q('div a[href*=youtube]').remove();
        video ? t.Q('article>iframe').src += video : t.Q('article>iframe').remove();
        t.Q('article').style.setProperty('--c', announce.colors.find(code));
        Q('#now fieldset').appendChild(t);
    });
    announce.colors = new Mapping(
        /組合/, 'hsl(250,70%,70%)',
        /Set/, 'hsl(250,70%,70%)',
        /Starter/, 'hsl(200,70%,60%)',
        /Random/, 'hsl(0,0%,90%)',
        /Booster/, 'hsl(10,70%,60%)',
        'hsl(45,70%,60%)'
    );

    Q('#reboot ul+h5').onpointerdown = ev => {
        let startT = new Date;
        ev.target.onpointerup = () => (new Date - startT) / 1000 > .5 ? Q('h5+dl').style.display = 'flex' : null;
    }
    let endX;
    const press = ({target: dragged, clientX: startX}) => {
        let message = dragged.nextElementSibling;
        let drop = message.nextElementSibling;
        let action = () => dragged.id == 'flush' ? flush(message) : reset(message);
        dragged.style.transition = null;
        document.onpointermove = document.ontouchmove = moving => move(moving, startX, dragged, drop);
        document.onpointerup = document.ontouchend = lifting => lift(lifting, dragged, drop, action);
    }
    Q('#reboot i:first-of-type', el => el.onpointerdown = press);
    const move = (moving, startX, dragged, drop) => {
        moving.preventDefault();
        endX = moving.clientX || moving.targetTouches?.[0].pageX; 
        dragged.style.transform = `translateX(${endX - startX}px)`;
        endX > drop.getBoundingClientRect().x ? dragged.style.background = 'lime' : null;
    }
    const lift = (lifting, dragged, drop, action) => {
        if (!document.onpointermove) return;
        document.onpointermove = document.ontouchmove = null;
        (lifting.clientX || endX) < drop.getBoundingClientRect().x ?
            Object.assign(dragged.style, {
                transform: null, background: null,
                transition: 'transform .5s'
            }) :
            action().then(() => {
                window.onbeforeunload = () => window.scrollTo(0, 0);
                location.reload();
            }).catch(er => console.error(er));
    }
    const flush = message => fetch('/burst/sw/update').then(resp => message.innerText = resp.status == 200 ? '成功' : '失敗');
    const reset = message => Promise.all([
        DB.discard('Burst', ev => message.innerText = ev.type == 'blocked' ? '請先關閉所有本網的分頁' : ev.type),
        caches.delete('Burst'), caches.delete('Burst/parts'),
        document.cookie.split(/;\s?/).forEach(c => document.cookie = c.replace(/=.*/, `=; max-age=0; path=/`))
    ]);
</script>

<script src="https://aeoq.github.io/dialog-gallery/script.js" type="module"></script>
<script type="module">
    import {A,E,O,Q} from 'https://aeoq.github.io/AEOQ.mjs'
    Q('body').append(
        E('dialog-gallery#catalog', [7,9,9,13,13,13,15,8,9,9].map((pages, s) => 
            E('figure', [...Array(pages+1)].map((_, p) => 
                E('img', {src: `img-catalogs/${`${s+2}`.padStart(2,0)}-${`${p}`.padStart(2,0)}.jpg`})
            ))
        ))
    );
</script>

<footer>
    對於本網所載資料的準確性或完整性，製作者不會作任何保證或聲明，或因提供或使用此網資料而直接或間接引致的任何損失、損壞或傷害，負上任何責任。
    <br>Developed and Designed by V Man (MKK). 2017-2023.
</footer>
